!function(){function a(b){function c(a,b,c,d){if("object"!=typeof i&&"function"!=typeof i||"function"!=typeof a)d();else try{var e=0;a.call(i,function(a){e++||(i=a,b())},function(a){e++||(i=a,c())})}catch(f){i=f,c()}}function d(){var a;try{a=i&&i.then}catch(b){return i=b,h=2,d()}c(a,function(){h=1,d()},function(){h=2,d()},function(){try{1==h&&"function"==typeof e?i=e(i):2==h&&"function"==typeof f&&(i=f(i),h=1)}catch(b){return i=b,k()}i==g?(i=TypeError(),k()):c(a,function(){k(3)},k,function(){k(1==h&&3)})})}if("function"!=typeof b&&void 0!=b)throw TypeError();var e,f,g=this,h=0,i=0,j=[];g.promise=g,g.resolve=function(a){return e=this.fn,f=this.er,h||(i=a,h=1,setTimeout(d)),this},g.reject=function(a){return e=this.fn,f=this.er,h||(i=a,h=2,setTimeout(d)),this},g.then=function(b,c){var d=new a;return d.fn=b,d.er=c,3==h?d.resolve(i):4==h?d.reject(i):j.push(d),d},g["catch"]=function(a){return g.then(null,a)};var k=function(a){h=a||4,j.map(function(a){3==h&&a.resolve(i)||a.reject(i)})};try{"function"==typeof b&&b(g.resolve,g.reject)}catch(l){g.reject(l)}return g}a.resolve=function(b){if(1!=this._d)throw TypeError();return new a(function(a){a(b)})},a.reject=function(b){if(1!=this._d)throw TypeError();return new a(function(a,c){c(b)})},a.all=function(b){function c(a,e){if(e)return d.resolve(e);if(a)return d.reject(a);var f=b.reduce(function(a,b){return b&&b.then?a+1:a},0);0==f&&d.resolve(b),b.map(function(a,d){a&&a.then&&a.then(function(a){return b[d]=a,c(),a},c)})}if(1!=this._d)throw TypeError();if(!(b instanceof Array))return a.reject(TypeError());var d=new a;return c(),d},a.race=function(b){function c(a,e){if(e)return d.resolve(e);if(a)return d.reject(a);var f=b.reduce(function(a,b){return b&&b.then?a+1:a},0);0==f&&d.resolve(b),b.map(function(a){a&&a.then&&a.then(function(a){c(null,a)},c)})}if(1!=this._d)throw TypeError();if(!(b instanceof Array))return a.reject(TypeError());if(0==b.length)return new a;var d=new a;return c(),d},a._d=1,"undefined"!=typeof module?module.exports=a:this.Promise=a}();