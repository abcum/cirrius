(function(){function e(e){if(typeof process!=="undefined"&&process.nextTick){process.nextTick(e)}else{setTimeout(e,0)}}var t=function(){function t(){this.state="pending";this.value;this.stack=[];this.throwing=false;this.resolve=function(e){if(this.state==="pending"){this.state="resolved";this.fire(e)}return this};this.reject=function(e){if(this.state==="pending"){this.state="rejected";this.fire(e)}return this};this.then=function(e,t){this.stack.push([e||function(){},t]);if(this.state!=="pending"){this.fire()}return this};this.done=function(){this.throwing=true;if(this.state!=="pending"){this.fire()}return void 0};this.throws=function(){this.throwing=true;return this};this.catch=function(e){this.stack.push([null,e||function(){}]);if(this.state!=="pending"){this.fire()}return this};this.fail=function(e){return this.catch(e)};this.nodeify=function(t){if(t){this.then(function(n){e(function(){t(null,n)});return n},function(n){e(function(){t(n)})})}return this};this.spread=function(e,t){return this.all().then(function(t){return e?e.apply(void 0,t):null},t)};this.all=function(){var e=this;this.stack.push([function(t){function i(){if(n!==t.length){return}e.resolve(t)}t=t instanceof Array?t:[];if(t.length===0){return t}e.state="pending";var n=0;var r=false;t.forEach(function(r,s){if(r&&r.then){r.then(function(e){t[s]=e;n++;i()},function(t){e.reject(t)})}else{t[s]=r;n++;i()}});return t},null]);if(this.state!=="pending"){this.fire()}return this};this.fire=function(e){e=this.value=typeof e!=="undefined"?e:this.value;while(this.stack.length&&this.state!=="pending"){var t=this.stack.shift();var n=this.state==="rejected"?t[1]:t[0];if(n){try{e=this.value=n.call(void 0,e);if(e&&e.then){var r=this.state;this.state="pending";var i=e.then(function(t){e=this.value=t;this.resolve(t)}.bind(this),function(n){e=this.value=n;if(r!=="rejected")this.stack.unshift(t);this.reject(n)}.bind(this))}else if(this.state==="rejected"){this.state="resolved"}}catch(s){e=this.value=s;if(this.state!=="rejected")this.stack.unshift(t);this.state="rejected"}}}if(this.throwing&&this.stack.length===0&&this.state==="rejected"){throw this.value}}}return{defer:function(){return new t},fcall:function(){var e=new t;var n=Array.apply([],arguments);var r=n.shift();try{var i=r.apply(void 0,n);e.resolve(i)}catch(s){e.reject(s)}return e},nfcall:function(){var e=new t;var n=Array.apply([],arguments);var r=n.shift();try{n.push(function(t,n){if(t){return e.reject(t)}return e.resolve(n)});r.apply(void 0,n)}catch(i){e.reject(i)}return e}}}();if(typeof module!=="undefined"&&module.exports){module.exports=t}else{this.promiz=t}})()
